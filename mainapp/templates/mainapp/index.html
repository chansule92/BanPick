<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="short icon" href="#" >
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student_list</title>
    <style>
        /* 스타일링 */
        html, body {
            background-color: #000;
            color: #fff;
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .container {
          max-width: 800px;
          margin: 0 auto;
          padding: 20px;
          text-align: center;
        }
        table {
            border-collapse: collapse;
            border : 1;
        }
        td {
            width: 150px;
            height: 150px;
            border: 1px solid #ffffff;
            position: relative;
        }
        .void {
           width: 20px; 
           border: 0px solid #ffffff;
           font-size: 40px;
           text-align:center;
        }
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #f9f9f9;
            min-width: 160px;
            box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
            z-index: 1;
            top: 100%;
            left: 0;
        }
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
        }
        .dropdown-content a:hover {
            background-color: #f1f1f1;
        }
        .search-box {
            padding: 10px;
        }
        .search-input {
            width: 100%;
            padding: 8px;
            margin-bottom: 8px;
            box-sizing: border-box;
        }
        .submit-button {
            margin-top: 20px;
            margin-left: 100px; /* 오른쪽으로 이동 */
            margin-right: 20px; /* 오른쪽 여백 설정 */
            display: block; /* 블록 요소로 설정하여 줄 바꿈 생성 */
            padding: 10px 20px; /* 내부 여백 설정 */
            background-color: #4CAF50; /* 배경색 */
            color: white; /* 텍스트 색상 */
            border: none; /* 테두리 제거 */
            border-radius: 5px; /* 버튼 모서리 둥글게 만들기 */
            cursor: pointer; /* 커서 모양 변경 */
            font-size: 16px; /* 폰트 크기 */
            transition: background-color 0.3s; /* 배경색 변화 시간 설정 */
        }
        .submit-button:hover {
            background-color: #45a049; /* 호버 시 배경색 변경 */
        }

      </style>

</head>
<body>
  
    <table id="myTable">
        <thead>
          <tr>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="void">Blue Team</td>
            <td class="void"></td>
            <td id="championImage0" onclick="toggleDropdown(this,0)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown0(this)"></td>      
            <td class="void"></td>
            <td id="championImage1" onclick="toggleDropdown(this,1)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown1(this)"></td>
            <td class="void"></td>
            <td id="championImage2" onclick="toggleDropdown(this,2)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown2(this)"></td>
            <td class="void"></td>
            <td id="championImage3" onclick="toggleDropdown(this,3)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown3(this)"></td>
            <td class="void"></td>
            <td id="championImage4" onclick="toggleDropdown(this,4)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown4(this)"></td>
          </tr>
          <tr>
            <td class="void"></td>
            <td class="void"></td>
            <td class="void"></td>
            <td class="void"></td>
            <td class="void"></td>
            <td class="void"></td>
            <td class="void" align="center">VS</td>
            <td class="void"></td>
            <td class="void"></td>
            <td class="void"></td>
            <td class="void"></td>
          </tr>
          <tr>
            <td class="void">Red Team</td>
            <td class="void"></td>
            <td id="championImage5" onclick="toggleDropdown(this,5)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown5(this)"></td>
            <td class="void"></td>
            <td id="championImage6" onclick="toggleDropdown(this,6)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown6(this)"></td>
            <td class="void"></td>
            <td id="championImage7" onclick="toggleDropdown(this,7)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown7(this)"></td>
            <td class="void"></td>
            <td id="championImage8" onclick="toggleDropdown(this,8)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown8(this)"></td>
            <td class="void"></td>
            <td id="championImage9" onclick="toggleDropdown(this,9)"><img src="" style="width: 100%; height: 100%;" onclick="toggleDropdown9(this)"></td>
          </tr>
        </tbody>
      </table>
      <form action="" method="post">
          {% csrf_token %}
          {% for i in pick %}
              <input type="hidden" id="championInput{{ i }}" name="champion{{ i }}" value="">
          {% endfor %}
          <button type="submit" class="submit-button">Submit</button>
      </form>
      {{value}}
    

        {% if processed_value %}
            <p>{{ processed_value }}</p>
        {% endif %}

      {% for j in pick %}
      
    <div class="dropdown-content" id="dropdown{{j}}">
      <div class="search-box">
          <input type="text" class="search-input" onkeyup="searchFunction(event,{{j}})" onclick="stopPropagation(event)" placeholder="검색하기">
      </div>
      {% for i in student_information %}
       <a href="#" id="championImage{{j}}_anchor" onclick="changeChampionImage('{{ i.EN }}', 'championImage{{j}}')">{{ i.KR }}</a>
      {% endfor %}
      
  </div>
  {% endfor %}
    <script>
        function submitForm() {
        // 1. 선택된 챔피언 이미지의 src 속성 값을 추출하여 input 필드에 저장합니다.
        const championImages = document.querySelectorAll('.champion-image');
        championImages.forEach(function(image) {
            const championName = image.src.split('/').pop().split('.')[0];
            const inputId = image.id.replace('championImage', 'championInput');
            const input = document.getElementById(inputId);
            input.value = championName;
        });

        // 2. 선택된 챔피언 정보를 Local Storage에 저장합니다.
        const championInputs = document.querySelectorAll('.champion-input');
        championInputs.forEach(function(input) {
            localStorage.setItem(input.id, input.value);
        });

        // 3. 페이지 새로고침 또는 다른 페이지 이동 후에도 Local Storage에 저장된 값을 input 필드에 다시 불러와 설정합니다.
        window.addEventListener('load', function() {
            const championInputs = document.querySelectorAll('.champion-input');
            championInputs.forEach(function(input) {
            input.value = localStorage.getItem(input.id);
            });
        });

        // 4. Submit 버튼 클릭 시 폼을 제출합니다.
        document.querySelector('form').submit();
        }
      function toggleDropdown(cell, index) {
        
          var dropdown = document.getElementById("dropdown" + index);
          var searchInput = dropdown.querySelector(".search-input");
          var parentId = cell.id; // 부모 요소인 <td>의 id를 가져옴

          // 부모 요소의 id를 사용하여 해당 이미지를 찾음
          var image = document.getElementById(parentId).querySelector("img");
          
          closeAllDropdowns();

          if (dropdown.style.display === "block") {
              dropdown.style.display = "none";
          } else {
              dropdown.style.display = "block";
              dropdown.style.top = (cell.offsetTop + cell.offsetHeight) + "px";
              dropdown.style.left = cell.offsetLeft + "px";
              searchInput.value = "";
              var a = dropdown.querySelectorAll("a");
              for (var i = 0; i < a.length; i++) {
                  a[i].style.display = "";
              }
          }
      }

      function searchFunction(event,index) {
          var input, filter, a, i;
          var dropdown = document.getElementById("dropdown"+index);
          input = dropdown.querySelector(".search-input");
          filter = input.value.toUpperCase();
          a = dropdown.querySelectorAll("a");
          for (i = 0; i < a.length; i++) {
              if (a[i].innerHTML.toUpperCase().indexOf(filter) > -1) {
                  a[i].style.display = "";
              } else {
                  a[i].style.display = "none";
              }
          }
          event.stopPropagation(); // 이벤트 전파 중지
      }
  
        window.onclick = function(event) {
            closeAllDropdowns();
        };

        function closeAllDropdowns() {
            var dropdowns = document.querySelectorAll('.dropdown-content');
            dropdowns.forEach(function(dropdown) {
                dropdown.style.display = 'none';
            });
        }


      // 클릭 이벤트 전파 중지 함수
      function stopPropagation(event) {
          event.stopPropagation();
      }
  
      // 드롭다운이 외부를 클릭하면 닫히도록 설정
      //window.onclick = function(event) {
      //    var dropdowns = document.querySelectorAll('.dropdown-content');
      //    dropdowns.forEach(function(dropdown) {
      //        var cell = dropdown.parentNode;
      //        if (!cell.contains(event.target) && dropdown.style.display === 'block') {
      //            dropdown.style.display = 'none';
      //        }
      //    });
      //}
        window.addEventListener('click', function(event) {
        const dropdowns = document.querySelectorAll('.dropdown-content');
        dropdowns.forEach(function(dropdown) {
            const cell = dropdown.parentNode; // 부모 요소인 <td>를 가져옴
            if (!cell.contains(event.target) && dropdown.style.display === 'block') {
            dropdown.style.display = 'none';
            }
        });
        });

        document.getElementById('myTable').addEventListener('click', function(event) {
        // <table> 안을 클릭하면 무시하도록 설정
        event.stopPropagation();
        });

       
      // 챔피언 이미지 변경 함수
      function changeChampionImage(championName, id) {
        var image = document.getElementById(id).querySelector("img");
        if (championName) {
            image.src = "/static/" + championName + ".png";
        } else {
            image.src = "None.png";
        }
        var input = document.getElementById("championInput" + id.replace('championImage', ''));
        input.value = championName;
    }
  </script>
  
</body>
</html>
